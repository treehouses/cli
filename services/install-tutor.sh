#!/bin/bash

address=$(sudo treehouses tor)
function install {

  mkdir -p /srv/tutor

  isTutorInstalled=$(ls /usr/local/bin | grep "tutor")
  if [ -z $isTutorInstalled ]; then
    echo "install tutor"
    wget -q  https://github.com/ole-vi/tutor-rpi/releases/download/v10.0.10-treehouses.1/tutor
    chmod +x tutor
    mv tutor /usr/local/bin/
  else
    echo "tutor is installed"
  fi
    
  # create yml(s)
  # yml is empty because tutor uses internal ymls
  # it is created for treehouses services to recognize 
  # tutor is installed
  touch /srv/tutor/tutor.yml

  # add autorun
  {
    echo "tutor_autorun=true"
    echo
    echo "if [ \"\$tutor_autorun\" = true ]; then"
    echo "  treehouses services tutor up"
    echo "fi"
    echo
    echo
  } > /srv/tutor/autorun
}

function up {
  su pi -c "tutor local quickstartfortreehouses"
}

function down {
  su pi -c "tutor local stop"
}

function start {
  su pi -c "tutor local start -d"
}

function stop {
  su pi -c "tutor local stop"
}

function stop {
  su pi -c "tutor local stop"
  su pi -c "tutor local start -d"
}

function cleanup {
  su pi -c "tutor local stop"
  docker rmi $(docker images --filter=reference='hirotochigi/openedx*' --format "{{.Repository}}:{{.Tag}}")
  rm -rf "$(tutor config printroot)"
  rm /usr/local/bin/tutor
}

function get_url {
 echo $address 
}

function get_email_address {
  echo "hiro@ole.org"
}

# environment var
function uses_env {
  echo false 
}

# add supported arm(s)
function supported_arms {
  echo "armv7l"
}

# add port(s)
function get_ports {
  echo "8090"
}

# add size (in MB)
function get_size {
  echo "4940"
}

# add info
function get_info {
  echo "https://github.com/ole-vi/tutor-rpi"
  echo
  echo "\"Tutor is a docker-based Open edX distribution, both for"
  echo "production and local development. The goal of Tutor is to"
  echo "make it easy to deploy, customize, upgrade and scale Open edX."
  echo "Tutor is reliable, fast, extensible, and it is already"
  echo "used by dozens of Open edX platforms around the world."\"
}

# add svg icon
function get_icon {
  cat <<EOF
<svg xmlns="http://www.w3.org/2000/svg" version="1" viewBox="0 0 64 64">
  <defs/>
  <path d="M4.0507995 32.000622c-.0118.333993-.050799.661986-.050799.999979C4.0000006 48.512268 16.487733 61 31.9994 61s27.999399-12.487732 27.999399-27.999399c0-.337673-.03904-.665266-.05078-.999979-.527989 15.041677-12.775726 26.999421-27.949401 26.999421-15.174074 0-27.4214118-11.957744-27.9494004-26.999421z" opacity=".2"/>
  <path fill="#fea238" d="M31.9998 4.0012441c-15.511667 0-27.9993994 12.4877319-27.9993994 27.9993999 0 15.511667 12.4877324 27.999399 27.9993994 27.999399 15.511667 0 27.999399-12.487732 27.999399-27.999399 0-15.511668-12.487732-27.9993999-27.999399-27.9993999z"/>
  <path fill="#fff" d="M32 4.0019531C16.488333 4.0019531 4 16.488332 4 32c0 .098348.0111933.193967.0175781.291016C4.3923697 17.110603 16.726112 5 32 5c15.273888 0 27.60763 12.110603 27.982422 27.291016C59.988769 32.194031 60 32.098203 60 32 60 16.488332 47.511667 4.0019531 32 4.0019531z" opacity=".2"/>
  <path d="M26.083984 21.013594c-.795565.04108-1.578202.192792-2.039062.441406-1.549607.835982-2.692552 1.933788-3.015625 3.71875-.08484.46871-.206411.907016-.269531.972656-.0631.06564-.372347.0456-.6875-.04492-.730904-.209896-1.777341.03358-2.669922.623047-.707445.46719-1.364587 2.061289-1.533203 3.048829-.09518.557486-.128746.185546-.683594.185546-.450191 0-.652223.09234-.892578.410157-.40807.539569-.390957.821472.05859 1.289062.364194.378571.395634.38326 3.109376.380859 1.008929-.000869 1.770924-.02796 2.294921-.0625.299388-.637679.690746-1.244 1.212891-1.787109 2.224683-2.314005 5.65475-2.659911 8.349609-1.173828.672748-1.178064 1.50757-2.191639 2.501953-2.958984-.0039-.123115-.133988-.642568-.296874-1.179688-.52699-1.738123-1.670455-2.986153-3.330079-3.636719-.506786-.198648-1.313806-.267646-2.109372-.226564zm11.861328 4.998047c-1.588727-.02893-3.228915.441077-4.677734 1.441406-1.38501.956179-2.366649 2.039968-2.892578 3.775391-.140877.46493-.319324.845703-.396484.845703-.07714 0-.369237-.510803-.650391-.767578-1.995957-1.82288-5.01963-1.705027-6.917969.269531-1.41265 1.469368-1.672349 4.036789-.953125 5.986328.07574.205255-.600683.367803-1.298828.734375-1.045218.548708-1.723414 1.330156-1.980469 2.285156-.46259 1.717963.868033 3.544765 2.683594 4.21875.759584.282373 2.227162.261685 3.101563-.04297.647986-.225795 1.284312-.818964 5.173828-4.830078 5.124091-5.284367 5.316554-5.925993 7.412109-5.933593 1.061118-.0039 1.819844.05747 2.703125.509765 1.201594.615386 2.082689 2.090488 2.511719 3.283203.399392 1.108976.402817 2.458381.0098 3.128907-.344254.587247-1.592686 1.136718-2.263672 1.136718-.666485 0-1.7867-.58374-2.058594-1.179687-.439173-1.019-.5037-1.980684.548794-2.873046-2.086901.05366-2.335914.830684-3 3.216797 0 1.649565.836381 3.235112 2.212891 3.658203.336193.103237 2.21293.144741 5.105468.113281 4.357726-.04738 4.600367-.06656 5.171875-.388672.837782-.47225 1.801043-1.550992 2.177735-2.439453.374532-.883381.441271-2.573606.148437-3.503906-.553845-1.625033-3.106577-3.377291-4.722656-2.277344-.282474.320715-.553476.04028-.603516-.01172-.04998-.05198.221858-.297013.359375-.789063.183636-.657566.234007-1.312561.191407-2.472656-.05422-1.475448-.09787-1.665769-.683594-2.919922-1.255973-2.68928-3.76423-4.125617-6.41211-4.173828z" opacity=".2"/>
  <path fill="#fff" d="M26.083984 20.013672c-.795565.041082-1.578202.192792-2.039062.441406-1.549607.835982-2.692552 1.933788-3.015625 3.71875-.084838.46871-.206411.907016-.269531.972656-.063099.065637-.372347.045599-.6875-.044922-.730904-.209896-1.777341.03358-2.669922.623047-.707445.46719-1.364587 2.061289-1.533203 3.048829-.095178.557486-.128746.185546-.683594.185546-.450191 0-.652223.092343-.892578.410157-.40807.539569-.390957.821472.058593 1.289062.364194.378571.395634.38326 3.109376.380859 1.008929-.000869 1.770924-.027964 2.294921-.0625.299388-.637679.690746-1.244 1.212891-1.787109 2.224683-2.314005 5.65475-2.659911 8.349609-1.173828.672748-1.178064 1.50757-2.191639 2.501953-2.958984-.003864-.123115-.133988-.642568-.296874-1.179688-.52699-1.738123-1.670455-2.986153-3.330079-3.636719-.506789-.198646-1.313809-.267644-2.109375-.226562zm11.861328 4.998047c-1.588727-.028927-3.228915.441077-4.677734 1.441406-1.38501.956179-2.366649 2.039968-2.892578 3.775391-.140877.46493-.319324.845703-.396484.845703-.077138 0-.369237-.510803-.650391-.767578-1.995957-1.82288-5.01963-1.705027-6.917969.269531-1.41265 1.469368-1.672349 4.036789-.953125 5.986328.075739.205255-.600683.367803-1.298828.734375-1.045218.548708-1.723414 1.330156-1.980469 2.285156-.46259 1.717963.868033 3.544765 2.683594 4.21875.759584.282373 2.227162.261685 3.101563-.042969.647986-.225795 1.284312-.818964 5.173828-4.830078 5.124091-5.284367 5.316554-5.925993 7.412109-5.933593 1.061118-.003879 1.819844.057474 2.703125.509765 1.201594.615386 2.082689 2.090488 2.511719 3.283203.399392 1.108976.402817 2.458381.009766 3.128907-.344254.587247-1.592686 1.136718-2.263672 1.136718-.666485 0-1.7867-.58374-2.058594-1.179687C37.012033 38.854046 36.947506 37.892362 38 37c-2.086901.053656-2.335914.830684-3 3.216797 0 1.649565.836381 3.235112 2.212891 3.658203.336193.103237 2.21293.144741 5.105468.113281 4.357726-.047379 4.600367-.066559 5.171875-.388672.837782-.47225 1.801043-1.550992 2.177735-2.439453.374532-.883381.441271-2.573606.148437-3.503906-.553845-1.625033-3.106577-3.377291-4.722656-2.277344-.282474.320715-.553476.040281-.603516-.011718-.049979-.051979.221858-.297013.359375-.789063.183636-.657566.234007-1.312561.191407-2.472656-.054219-1.475448-.097866-1.665769-.683594-2.919922-1.255973-2.68928-3.76423-4.125617-6.41211-4.173828z"/>
</svg>
EOF
}
